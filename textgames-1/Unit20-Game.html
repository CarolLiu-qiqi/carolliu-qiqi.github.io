<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>海上补给单元游戏</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net.net/npm/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0A3D62', // 海军蓝作为主色调
            secondary: '#3C6382',
            accent: '#60A3BC',
            neutral: '#1E272E',
            light: '#F8FAFC',
          },
          fontFamily: {
            serif: ['Garamond', 'Georgia', 'serif'],
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-flip {
        transform-style: preserve-3d;
        transition: transform 0.6s;
      }
      .card-flip-active {
        transform: rotateY(180deg);
      }
      .card-front, .card-back {
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }
      .card-back {
        transform: rotateY(180deg);
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      .animate-float {
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
      }
      .bg-pattern {
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230A3D62' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      }
    }
  </style>
</head>

<body class="bg-light bg-pattern min-h-screen font-sans text-neutral">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-sm shadow-md">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <i class="fa fa-ship text-secondary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-primary font-serif">海上补给单元游戏</h1>
      </div>
      <div class="flex items-center space-x-4">
        <span id="progress-indicator" class="hidden md:inline-flex items-center text-sm">
          <i class="fa fa-book text-accent mr-1"></i>
          <span>进度: <span id="progress-percentage">0%</span></span>
        </span>
        <button id="sound-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
          <i class="fa fa-volume-up text-neutral"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <!-- 欢迎界面 -->
    <section id="welcome-screen" class="min-h-[70vh] flex flex-col items-center justify-center text-center">
      <div class="mb-10 animate-float">
        <i class="fa fa-refresh text-6xl text-primary/80 fa-spin"></i>
      </div>
      <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold mb-4 text-shadow font-serif text-primary">海上补给单元游戏</h2>
      <p class="text-gray-600 max-w-2xl mb-8 text-lg">通过交互式学习和趣味游戏，掌握海上补给相关专业词汇，提升专业表达能力</p>
      <div class="flex flex-col sm:flex-row gap-4 w-full max-w-md">
        <button id="start-learning" class="flex-1 bg-primary hover:bg-primary/90 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
          <i class="fa fa-graduation-cap mr-2"></i>开始学习
        </button>
        <button id="start-game" class="flex-1 bg-secondary hover:bg-secondary/90 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
          <i class="fa fa-gamepad mr-2"></i>趣味游戏
        </button>
      </div>
    </section>

    <!-- 学习模块 -->
    <section id="learning-module" class="hidden">
      <div class="flex justify-between items-center mb-6">
        <button id="back-from-learning" class="flex items-center text-gray-600 hover:text-primary transition-colors">
          <i class="fa fa-arrow-left mr-2"></i>返回
        </button>
        <div class="text-sm text-gray-500">
          <span id="current-word-index">1</span>/<span id="total-words">0</span>
        </div>
      </div>

      <!-- 单词卡片 -->
      <div class="relative w-full max-w-2xl mx-auto aspect-[4/3] mb-8">
        <div id="word-card" class="card-flip w-full h-full absolute">
          <!-- 卡片正面 - 单词和音标 -->
          <div class="card-front absolute w-full h-full bg-white rounded-2xl shadow-xl p-8 flex flex-col justify-center items-center text-center border-2 border-primary/20">
            <div class="absolute top-4 right-4 opacity-20">
              <i class="fa fa-ship text-3xl text-primary"></i>
            </div>
            <h3 id="word-spelling" class="text-3xl md:text-4xl font-bold text-primary mb-4 font-serif"></h3>
            <div id="word-phonetic" class="text-gray-600 text-lg italic"></div>
            <p class="mt-8 text-gray-500 text-sm">点击卡片查看详情</p>
            <i class="fa fa-refresh text-gray-300 absolute bottom-4"></i>
          </div>
          
          <!-- 卡片背面 - 释义和功能 -->
          <div class="card-back absolute w-full h-full bg-white rounded-2xl shadow-xl p-8 flex flex-col border-2 border-primary/20">
            <div class="absolute top-4 right-4 opacity-20">
              <i class="fa fa-ship text-3xl text-primary"></i>
            </div>
            <h3 id="word-spelling-back" class="text-2xl font-bold text-primary mb-2 font-serif"></h3>
            <div id="word-part" class="text-accent font-medium mb-4"></div>
            <div id="word-definition" class="flex-grow text-gray-700 mb-6"></div>
            <div class="flex justify-between items-center">
              <button id="mark-mastered" class="text-secondary hover:text-secondary/80 flex items-center transition-colors">
                <i class="fa fa-check-circle mr-1"></i> 已掌握
              </button>
              <button id="play-pronunciation" class="text-primary hover:text-primary/80 transition-colors p-2 rounded-full hover:bg-primary/10">
                <i class="fa fa-volume-up"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 导航按钮 -->
      <div class="flex justify-between max-w-2xl mx-auto">
        <button id="prev-word" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <i class="fa fa-arrow-left mr-2"></i>上一个
        </button>
        <button id="next-word" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          下一个<i class="fa fa-arrow-right ml-2"></i>
        </button>
      </div>

      <!-- 已掌握单词列表 -->
      <div class="mt-12">
        <h4 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fa fa-check-square-o text-secondary mr-2"></i>已掌握单词
        </h4>
        <div id="mastered-words" class="flex flex-wrap gap-2">
          <p class="text-gray-500 italic">尚未掌握任何单词</p>
        </div>
      </div>
    </section>

    <!-- 游戏模块 -->
    <section id="game-module" class="hidden">
      <div class="flex justify-between items-center mb-6">
        <button id="back-from-game" class="flex items-center text-gray-600 hover:text-primary transition-colors">
          <i class="fa fa-arrow-left mr-2"></i>返回
        </button>
        <div id="game-score" class="bg-accent/10 text-accent font-semibold py-1 px-3 rounded-full text-sm">
          得分: <span id="current-score">0</span>
        </div>
      </div>

      <!-- 游戏选择 -->
      <div id="game-selection" class="min-h-[60vh] flex flex-col items-center justify-center">
        <h2 class="text-2xl font-bold mb-8 text-center font-serif text-primary">选择游戏模式</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl">
          <!-- 单词配对游戏 -->
          <div class="game-card bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transition-all transform hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-primary group">
            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-primary/20 transition-colors">
              <i class="fa fa-exchange text-2xl text-primary"></i>
            </div>
            <h3 class="font-bold text-lg mb-2 font-serif">补给词汇配对</h3>
            <p class="text-gray-600 text-sm">将海上补给词汇与对应的释义进行配对</p>
            <button data-game="matching" class="mt-4 text-primary font-medium hover:underline">开始游戏</button>
          </div>

          <!-- 拼写测验 -->
          <div class="game-card bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transition-all transform hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-secondary group">
            <div class="w-16 h-16 bg-secondary/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-secondary/20 transition-colors">
              <i class="fa fa-pencil text-2xl text-secondary"></i>
            </div>
            <h3 class="font-bold text-lg mb-2 font-serif">补给词汇拼写</h3>
            <p class="text-gray-600 text-sm">根据发音和释义拼写出正确的海上补给词汇</p>
            <button data-game="spelling" class="mt-4 text-secondary font-medium hover:underline">开始游戏</button>
          </div>

          <!-- 词义匹配 -->
          <div class="game-card bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transition-all transform hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-accent group">
            <div class="w-16 h-16 bg-accent/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-accent/20 transition-colors">
              <i class="fa fa-question-circle text-2xl text-accent"></i>
            </div>
            <h3 class="font-bold text-lg mb-2 font-serif">补给词汇释义</h3>
            <p class="text-gray-600 text-sm">从选项中选择海上补给词汇的正确释义</p>
            <button data-game="definition" class="mt-4 text-accent font-medium hover:underline">开始游戏</button>
          </div>
        </div>
      </div>

      <!-- 配对游戏 -->
      <div id="matching-game" class="hidden">
        <h3 class="text-xl font-bold mb-6 text-center font-serif text-primary">海上补给词汇配对游戏</h3>
        <p class="text-gray-600 text-center mb-8">找出与海上补给词汇匹配的释义，限时60秒</p>
        
        <div id="timer" class="text-center mb-6 text-lg font-semibold text-primary">
          剩余时间: <span id="time-left">60</span>秒
        </div>
        
        <div id="matching-board" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <!-- 动态生成卡片 -->
        </div>
        
        <div class="text-center">
          <button id="restart-matching" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors">
            <i class="fa fa-refresh mr-2"></i>重新开始
          </button>
        </div>
      </div>

      <!-- 拼写游戏 -->
      <div id="spelling-game" class="hidden">
        <h3 class="text-xl font-bold mb-6 text-center font-serif text-primary">海上补给词汇拼写测验</h3>
        <p class="text-gray-600 text-center mb-4">根据发音和释义，拼写出正确的海上补给词汇</p>
        
        <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 mb-6 border border-primary/10">
          <div class="absolute -top-3 -right-3 opacity-10">
            <i class="fa fa-ship text-5xl text-primary"></i>
          </div>
          <div id="spelling-hint" class="mb-4 text-gray-700"></div>
          <div class="flex items-center mb-4">
            <button id="spelling-pronounce" class="text-primary hover:text-primary/80 transition-colors p-2 rounded-full hover:bg-primary/10">
              <i class="fa fa-volume-up"></i> 听发音
            </button>
          </div>
          <input type="text" id="spelling-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary" placeholder="请输入单词...">
          <div id="spelling-feedback" class="mt-3 text-sm hidden"></div>
        </div>
        
        <div class="text-center">
          <button id="check-spelling" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors mr-2">
            检查答案
          </button>
          <button id="next-spelling" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-6 rounded-lg transition-colors hidden">
            下一个
          </button>
          <button id="restart-spelling" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors mt-4">
            <i class="fa fa-refresh mr-2"></i>重新开始
          </button>
        </div>
      </div>

      <!-- 词义匹配游戏 -->
      <div id="definition-game" class="hidden">
        <h3 class="text-xl font-bold mb-6 text-center font-serif text-primary">海上补给词汇释义匹配</h3>
        <p class="text-gray-600 text-center mb-4">从选项中选择海上补给词汇的正确释义</p>
        
        <div class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-6 mb-6 border border-primary/10">
          <div class="absolute -top-3 -right-3 opacity-10">
            <i class="fa fa-ship text-5xl text-primary"></i>
          </div>
          <div id="definition-word" class="text-xl font-bold text-primary mb-4 text-center font-serif"></div>
          <div id="definition-options" class="space-y-3">
            <!-- 动态生成选项 -->
          </div>
        </div>
        
        <div class="text-center">
          <button id="next-definition" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors hidden">
            下一个
          </button>
          <button id="restart-definition" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-colors mt-4">
            <i class="fa fa-refresh mr-2"></i>重新开始
          </button>
        </div>
      </div>
    </section>

    <!-- 游戏结果弹窗 -->
    <div id="game-result-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center transform transition-all border-2 border-primary/20">
        <div class="absolute top-4 right-4 opacity-20">
          <i class="fa fa-ship text-3xl text-primary"></i>
        </div>
        <div id="result-icon" class="w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center">
          <i class="fa fa-trophy text-2xl"></i>
        </div>
        <h3 id="result-title" class="text-2xl font-bold mb-2 font-serif text-primary"></h3>
        <p id="result-message" class="text-gray-600 mb-6"></p>
        <div class="flex justify-center gap-4">
          <button id="play-again" class="bg-primary hover:bg-primary/90 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
            再玩一次
          </button>
          <button id="back-to-games" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-lg transition-colors">
            返回游戏选择
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-white mt-12 py-6 border-t border-primary/10">
    <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
      <p>海上补给单元游戏 &copy; 2023 - 提升您的海上补给专业表达能力</p>
    </div>
  </footer>

  <script>
    // 海上补给词汇数据
    const vocabulary = [
      {
        spelling: "approximately",
        phonetic: "/əˈprɒksɪmətli/",
        part: "adv.",
        definition: "大约，近似于"
      },
      {
        spelling: "astride",
        phonetic: "/əˈstraɪd/",
        part: "prep.",
        definition: "（跨越）在…上，在（河、路等的）两边"
      },
      {
        spelling: "blue-water navy",
        phonetic: "/bluː ˈwɔːtə ˈneɪvi/",
        part: "n.",
        definition: "深海海军"
      },
      {
        spelling: "break bulk goods",
        phonetic: "/breɪk bʌlk ɡʊdz/",
        part: "n.",
        definition: "散装货物"
      },
      {
        spelling: "duplicate",
        phonetic: "/ˈdjuːplɪkeɪt/",
        part: "vt.",
        definition: "复制，重复"
      },
      {
        spelling: "Military Sealift Command",
        phonetic: "/ˈmɪlətri ˈsiːlɪft kəˈmɑːnd/",
        part: "n.",
        definition: "海军海运司令部，海事海运指挥部"
      },
      {
        spelling: "munitions",
        phonetic: "/mjuːˈnɪʃənz/",
        part: "n.",
        definition: "军火、军需品（尤指武器弹药）"
      },
      {
        spelling: "naval operations",
        phonetic: "/ˈneɪvl ˌɒpəˈreɪʃənz/",
        part: "n.",
        definition: "海军作战"
      },
      {
        spelling: "prior to",
        phonetic: "/ˈpraɪə(r) tu/",
        part: "phrase",
        definition: "在...之前"
      },
      {
        spelling: "receiver ship",
        phonetic: "/rɪˈsiːvə(r) ʃɪp/",
        part: "n.",
        definition: "接收舰（被补给舰）"
      },
      {
        spelling: "supplement",
        phonetic: "/ˈsʌplɪmənt/",
        part: "n.",
        definition: "增补、补充"
      },
      {
        spelling: "supply ship",
        phonetic: "/səˈplaɪ ʃɪp/",
        part: "n.",
        definition: "补给舰"
      },
      {
        spelling: "CONREP",
        phonetic: "/ˈkɒnrep/",
        part: "abbr.",
        definition: "(alongside connected replenishment) 横向补给"
      },
      {
        spelling: "RAS",
        phonetic: "/ræs/",
        part: "abbr.",
        definition: "(replenishment at sea) 海上补给"
      },
      {
        spelling: "VERTREP",
        phonetic: "/ˈvɜːrtrep/",
        part: "abbr.",
        definition: "(vertical replenishment) 垂直补给"
      }
    ];

    // 全局状态
    const state = {
      currentWordIndex: 0,
      masteredWords: [],
      score: 0,
      currentGame: null,
      gameTimer: null,
      currentSpellingWord: null,
      matchingState: {
        flippedCards: [],
        matchedPairs: 0,
        totalPairs: 0
      },
      soundEnabled: true
    };

    // 页面加载完成后初始化
    window.onload = function() {
      // 获取DOM元素并绑定事件
      const startLearningBtn = document.getElementById('start-learning');
      const startGameBtn = document.getElementById('start-game');
      const welcomeScreen = document.getElementById('welcome-screen');
      const learningModule = document.getElementById('learning-module');
      const gameModule = document.getElementById('game-module');
      const backFromLearning = document.getElementById('back-from-learning');
      const backFromGame = document.getElementById('back-from-game');
      
      // 绑定按钮点击事件
      if (startLearningBtn) {
        startLearningBtn.onclick = function() {
          welcomeScreen.classList.add('hidden');
          learningModule.classList.remove('hidden');
        };
      }
      
      if (startGameBtn) {
        startGameBtn.onclick = function() {
          welcomeScreen.classList.add('hidden');
          gameModule.classList.remove('hidden');
          resetGameScore();
        };
      }
      
      if (backFromLearning) {
        backFromLearning.onclick = function() {
          learningModule.classList.add('hidden');
          welcomeScreen.classList.remove('hidden');
        };
      }
      
      if (backFromGame) {
        backFromGame.onclick = function() {
          gameModule.classList.add('hidden');
          welcomeScreen.classList.remove('hidden');
          stopGameTimer();
        };
      }

      // 初始化单词总数
      document.getElementById('total-words').textContent = vocabulary.length;
      displayWord(0);
      setupGameEventListeners();
    };

    // 设置游戏相关事件监听器
    function setupGameEventListeners() {
      // 单词卡片翻转
      document.getElementById('word-card').onclick = function() {
        this.classList.toggle('card-flip-active');
      };
      
      // 学习模块导航
      document.getElementById('prev-word').onclick = function() {
        if (state.currentWordIndex > 0) {
          state.currentWordIndex--;
          displayWord(state.currentWordIndex);
          document.getElementById('word-card').classList.remove('card-flip-active');
        }
      };
      
      document.getElementById('next-word').onclick = function() {
        if (state.currentWordIndex < vocabulary.length - 1) {
          state.currentWordIndex++;
          displayWord(state.currentWordIndex);
          document.getElementById('word-card').classList.remove('card-flip-active');
        }
      };
      
      // 标记已掌握
      document.getElementById('mark-mastered').onclick = function() {
        const word = vocabulary[state.currentWordIndex];
        if (!state.masteredWords.includes(word.spelling)) {
          state.masteredWords.push(word.spelling);
        } else {
          state.masteredWords = state.masteredWords.filter(w => w !== word.spelling);
        }
        updateMasteredWordsDisplay();
        updateProgress();
        displayWord(state.currentWordIndex); // 更新按钮状态
      };
      
      // 游戏选择
      document.querySelectorAll('[data-game]').forEach(button => {
        button.onclick = function() {
          const gameType = this.getAttribute('data-game');
          startGame(gameType);
        };
      });
      
      // 配对游戏重新开始
      document.getElementById('restart-matching').onclick = function() {
        startMatchingGame();
      };
      
      // 拼写游戏
      document.getElementById('check-spelling').onclick = checkSpellingAnswer;
      document.getElementById('next-spelling').onclick = setupSpellingQuestion;
      document.getElementById('restart-spelling').onclick = startSpellingGame;
      document.getElementById('spelling-pronounce').onclick = function() {
        if (state.currentSpellingWord) {
          playPronunciation(state.currentSpellingWord.spelling);
        }
      };
      
      // 词义匹配游戏
      document.getElementById('next-definition').onclick = setupDefinitionQuestion;
      document.getElementById('restart-definition').onclick = startDefinitionGame;
      
      // 结果弹窗
      document.getElementById('play-again').onclick = function() {
        document.getElementById('game-result-modal').classList.add('hidden');
        if (state.currentGame) {
          startGame(state.currentGame);
        }
      };
      
      document.getElementById('back-to-games').onclick = function() {
        document.getElementById('game-result-modal').classList.add('hidden');
        document.getElementById('matching-game').classList.add('hidden');
        document.getElementById('spelling-game').classList.add('hidden');
        document.getElementById('definition-game').classList.add('hidden');
        document.getElementById('game-selection').classList.remove('hidden');
      };
      
      // 声音开关
      document.getElementById('sound-toggle').onclick = function() {
        const icon = this.querySelector('i');
        state.soundEnabled = !state.soundEnabled;
        if (state.soundEnabled) {
          icon.classList.remove('fa-volume-off');
          icon.classList.add('fa-volume-up');
        } else {
          icon.classList.remove('fa-volume-up');
          icon.classList.add('fa-volume-off');
        }
      };
    }

    // 显示单词
    function displayWord(index) {
      const word = vocabulary[index];
      document.getElementById('word-spelling').textContent = word.spelling;
      document.getElementById('word-phonetic').textContent = word.phonetic;
      document.getElementById('word-spelling-back').textContent = word.spelling;
      document.getElementById('word-part').textContent = word.part;
      document.getElementById('word-definition').textContent = word.definition;
      document.getElementById('current-word-index').textContent = index + 1;
      
      // 更新导航按钮状态
      document.getElementById('prev-word').disabled = index === 0;
      document.getElementById('next-word').disabled = index === vocabulary.length - 1;
      
      // 更新"已掌握"按钮状态
      const markBtn = document.getElementById('mark-mastered');
      if (state.masteredWords.includes(word.spelling)) {
        markBtn.innerHTML = '<i class="fa fa-check-circle mr-1"></i> 取消掌握';
        markBtn.classList.remove('text-secondary');
        markBtn.classList.add('text-gray-500');
      } else {
        markBtn.innerHTML = '<i class="fa fa-check-circle mr-1"></i> 已掌握';
        markBtn.classList.remove('text-gray-500');
        markBtn.classList.add('text-secondary');
      }
    }

    // 更新已掌握单词显示
    function updateMasteredWordsDisplay() {
      const container = document.getElementById('mastered-words');
      if (state.masteredWords.length === 0) {
        container.innerHTML = '<p class="text-gray-500 italic">尚未掌握任何单词</p>';
        return;
      }
      
      container.innerHTML = '';
      state.masteredWords.forEach(word => {
        const badge = document.createElement('span');
        badge.className = 'bg-secondary/10 text-secondary text-xs px-2 py-1 rounded-full flex items-center';
        badge.innerHTML = `${word} <i class="fa fa-times-circle ml-1 cursor-pointer" data-word="${word}"></i>`;
        badge.querySelector('i').onclick = function(e) {
          e.stopPropagation();
          const word = this.getAttribute('data-word');
          state.masteredWords = state.masteredWords.filter(w => w !== word);
          updateMasteredWordsDisplay();
          updateProgress();
          displayWord(state.currentWordIndex);
        };
        container.appendChild(badge);
      });
    }

    // 更新学习进度
    function updateProgress() {
      const percentage = Math.round((state.masteredWords.length / vocabulary.length) * 100);
      document.getElementById('progress-percentage').textContent = `${percentage}%`;
    }

    // 播放单词发音
    function playPronunciation(word) {
      if (!state.soundEnabled) return;
      
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
    }

    // 开始游戏
    function startGame(gameType) {
      state.currentGame = gameType;
      resetGameScore();
      
      // 隐藏游戏选择，显示对应游戏
      document.getElementById('game-selection').classList.add('hidden');
      document.getElementById('matching-game').classList.add('hidden');
      document.getElementById('spelling-game').classList.add('hidden');
      document.getElementById('definition-game').classList.add('hidden');
      
      if (gameType === 'matching') {
        document.getElementById('matching-game').classList.remove('hidden');
        startMatchingGame();
      } else if (gameType === 'spelling') {
        document.getElementById('spelling-game').classList.remove('hidden');
        startSpellingGame();
      } else if (gameType === 'definition') {
        document.getElementById('definition-game').classList.remove('hidden');
        startDefinitionGame();
      }
    }

    // 重置游戏分数
    function resetGameScore() {
      state.score = 0;
      document.getElementById('current-score').textContent = state.score;
    }

    // 增加分数
    function increaseScore(points = 10) {
      state.score += points;
      document.getElementById('current-score').textContent = state.score;
    }

    // 开始配对游戏
    function startMatchingGame() {
      state.matchingState = {
        flippedCards: [],
        matchedPairs: 0,
        totalPairs: 0
      };
      
      // 选择6个单词来进行配对
      const shuffledWords = [...vocabulary].sort(() => Math.random() - 0.5).slice(0, 6);
      state.matchingState.totalPairs = shuffledWords.length;
      
      // 创建卡片数组
      const cards = [];
      shuffledWords.forEach(word => {
        cards.push({type: 'word', content: word.spelling, pairId: word.spelling});
        cards.push({type: 'definition', content: word.definition, pairId: word.spelling});
      });
      
      // 打乱卡片顺序
      const shuffledCards = cards.sort(() => Math.random() - 0.5);
      
      // 清空游戏板并添加卡片
      const board = document.getElementById('matching-board');
      board.innerHTML = '';
      shuffledCards.forEach((card) => {
        const cardElement = document.createElement('div');
        cardElement.className = 'matching-card relative aspect-square cursor-pointer';
        cardElement.innerHTML = `
          <div class="absolute inset-0 rounded-xl shadow-md transition-all duration-300">
            <!-- 卡片正面 -->
            <div class="absolute inset-0 bg-primary/10 rounded-xl flex items-center justify-center">
              <i class="fa fa-ship text-primary/50 text-2xl"></i>
            </div>
            <!-- 卡片背面 -->
            <div class="absolute inset-0 bg-white rounded-xl flex items-center justify-center p-3 text-center transform rotate-y-180 ${card.type === 'word' ? 'text-primary font-semibold' : 'text-gray-700'}">
              ${card.content}
            </div>
          </div>
        `;
        
        // 添加点击事件
        cardElement.onclick = function() {
          flipMatchingCard(cardElement, card);
        };
        
        board.appendChild(cardElement);
      });
      
      // 开始计时
      startGameTimer(60);
    }

    // 翻转配对卡片
    function flipMatchingCard(cardElement, cardData) {
      if (state.matchingState.flippedCards.length >= 2 || 
          cardElement.classList.contains('flipped') || 
          cardElement.classList.contains('matched')) {
        return;
      }
      
      // 翻转卡片
      cardElement.classList.add('flipped');
      const innerCard = cardElement.querySelector('div');
      innerCard.classList.add('rotate-y-180');
      
      // 记录翻开的卡片
      state.matchingState.flippedCards.push({
        element: cardElement,
        data: cardData
      });
      
      // 如果翻开了两张卡片，检查是否匹配
      if (state.matchingState.flippedCards.length === 2) {
        setTimeout(checkMatchingPair, 500);
      }
    }

    // 检查配对是否成功
    function checkMatchingPair() {
      const [card1, card2] = state.matchingState.flippedCards;
      
      if (card1.data.pairId === card2.data.pairId) {
        // 匹配成功
        card1.element.classList.add('matched', 'opacity-70');
        card2.element.classList.add('matched', 'opacity-70');
        card1.element.querySelector('.rotate-y-180').classList.add('bg-secondary/10');
        card2.element.querySelector('.rotate-y-180').classList.add('bg-secondary/10');
        
        state.matchingState.matchedPairs++;
        increaseScore(15);
        
        // 检查游戏是否结束
        if (state.matchingState.matchedPairs === state.matchingState.totalPairs) {
          stopGameTimer();
          setTimeout(() => {
            showGameResult(
              '恭喜你！', 
              `你成功完成了所有海上补给词汇配对，得分: ${state.score}`, 
              'success'
            );
          }, 500);
        }
      } else {
        // 匹配失败，翻回
        setTimeout(() => {
          card1.element.classList.remove('flipped');
          card2.element.classList.remove('flipped');
          card1.element.querySelector('div').classList.remove('rotate-y-180');
          card2.element.querySelector('div').classList.remove('rotate-y-180');
        }, 1000);
      }
      
      // 重置已翻开卡片列表
      state.matchingState.flippedCards = [];
    }

    // 开始游戏计时器
    function startGameTimer(seconds) {
      stopGameTimer();
      
      let timeRemaining = seconds;
      document.getElementById('time-left').textContent = timeRemaining;
      
      state.gameTimer = setInterval(() => {
        timeRemaining--;
        document.getElementById('time-left').textContent = timeRemaining;
        
        if (timeRemaining <= 10) {
          document.getElementById('timer').classList.add('animate-pulse');
        }
        
        if (timeRemaining <= 0) {
          stopGameTimer();
          document.getElementById('timer').classList.remove('animate-pulse');
          showGameResult(
            '时间到！', 
            `游戏结束，你的海上补给词汇配对得分: ${state.score}`, 
            'info'
          );
        }
      }, 1000);
    }

    // 停止游戏计时器
    function stopGameTimer() {
      if (state.gameTimer) {
        clearInterval(state.gameTimer);
        state.gameTimer = null;
      }
    }

    // 开始拼写游戏
    function startSpellingGame() {
      resetGameScore();
      setupSpellingQuestion();
    }

    // 设置拼写问题
    function setupSpellingQuestion() {
      const randomIndex = Math.floor(Math.random() * vocabulary.length);
      state.currentSpellingWord = vocabulary[randomIndex];
      
      document.getElementById('spelling-hint').textContent = `释义: ${state.currentSpellingWord.definition}`;
      document.getElementById('spelling-input').value = '';
      document.getElementById('spelling-feedback').classList.add('hidden');
      document.getElementById('check-spelling').classList.remove('hidden');
      document.getElementById('next-spelling').classList.add('hidden');
      document.getElementById('spelling-input').focus();
    }

    // 检查拼写答案
    function checkSpellingAnswer() {
      const userAnswer = document.getElementById('spelling-input').value.trim().toLowerCase();
      const correctAnswer = state.currentSpellingWord.spelling.toLowerCase();
      const feedback = document.getElementById('spelling-feedback');
      
      feedback.classList.remove('hidden');
      
      if (userAnswer === correctAnswer) {
        feedback.textContent = '正确！太棒了！';
        feedback.className = 'mt-3 text-sm text-secondary';
        increaseScore(20);
        document.getElementById('check-spelling').classList.add('hidden');
        document.getElementById('next-spelling').classList.remove('hidden');
        
        // 如果已经回答了5个问题，结束游戏
        if (state.score >= 100) {
          setTimeout(() => {
            showGameResult(
              '恭喜完成！', 
              `你完成了海上补给词汇拼写测验，最终得分: ${state.score}`, 
              'success'
            );
          }, 1000);
        }
      } else {
        feedback.textContent = `不正确。正确答案是: ${state.currentSpellingWord.spelling}`;
        feedback.className = 'mt-3 text-sm text-red-500';
        document.getElementById('check-spelling').classList.add('hidden');
        document.getElementById('next-spelling').classList.remove('hidden');
      }
    }

    // 开始词义匹配游戏
    function startDefinitionGame() {
      resetGameScore();
      setupDefinitionQuestion();
    }

    // 设置词义匹配问题
    function setupDefinitionQuestion() {
      const correctIndex = Math.floor(Math.random() * vocabulary.length);
      state.currentDefinitionWord = vocabulary[correctIndex];
      
      document.getElementById('definition-word').textContent = state.currentDefinitionWord.spelling;
      
      // 生成选项
      const allDefinitions = vocabulary.map(word => word.definition);
      const correctDefinition = state.currentDefinitionWord.definition;
      const otherDefinitions = allDefinitions.filter(def => def !== correctDefinition);
      const shuffledOthers = otherDefinitions.sort(() => Math.random() - 0.5).slice(0, 3);
      const options = [correctDefinition, ...shuffledOthers].sort(() => Math.random() - 0.5);
      
      // 显示选项
      const optionsContainer = document.getElementById('definition-options');
      optionsContainer.innerHTML = '';
      options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors';
        optionElement.innerHTML = `<span class="font-medium mr-2">${String.fromCharCode(65 + index)}</span>${option}`;
        
        optionElement.onclick = function() {
          checkDefinitionAnswer(option === correctDefinition, optionElement);
        };
        
        optionsContainer.appendChild(optionElement);
      });
      
      document.getElementById('next-definition').classList.add('hidden');
    }

    // 检查词义匹配答案
    function checkDefinitionAnswer(isCorrect, selectedElement) {
      document.querySelectorAll('#definition-options > div').forEach(option => {
        option.classList.remove('hover:bg-gray-50', 'cursor-pointer');
        option.style.pointerEvents = 'none';
      });
      
      if (isCorrect) {
        selectedElement.classList.add('bg-secondary/10', 'border-secondary');
        increaseScore(15);
      } else {
        selectedElement.classList.add('bg-red-50', 'border-red-200');
        
        document.querySelectorAll('#definition-options > div').forEach(option => {
          if (option.textContent.includes(state.currentDefinitionWord.definition)) {
            option.classList.add('bg-secondary/10', 'border-secondary');
          }
        });
      }
      
      document.getElementById('next-definition').classList.remove('hidden');
      
      // 如果已经回答了5个问题，结束游戏
      if (state.score >= 75) {
        setTimeout(() => {
          showGameResult(
            '恭喜完成！', 
            `你完成了海上补给词汇释义匹配，最终得分: ${state.score}`, 
            'success'
          );
        }, 1000);
      }
    }

    // 显示游戏结果
    function showGameResult(title, message, type = 'info') {
      document.getElementById('result-title').textContent = title;
      document.getElementById('result-message').textContent = message;
      
      const resultIcon = document.getElementById('result-icon');
      resultIcon.className = 'w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center';
      
      if (type === 'success') {
        resultIcon.classList.add('bg-secondary/20', 'text-secondary');
        resultIcon.innerHTML = '<i class="fa fa-trophy text-2xl"></i>';
      } else if (type === 'error') {
        resultIcon.classList.add('bg-red-100', 'text-red-500');
        resultIcon.innerHTML = '<i class="fa fa-times-circle text-2xl"></i>';
      } else {
        resultIcon.classList.add('bg-primary/20', 'text-primary');
        resultIcon.innerHTML = '<i class="fa fa-info-circle text-2xl"></i>';
      }
      
      document.getElementById('game-result-modal').classList.remove('hidden');
    }
  </script>
</body>
</html>
